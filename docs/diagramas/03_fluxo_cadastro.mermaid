sequenceDiagram
    participant U as Usuario
    participant N as Next.js
    participant S as Supabase
    participant SH as Shopify

    Note over U,SH: Fluxo de Cadastro

    U->>N: POST /api/members/join
    
    N->>S: 1. Verifica email unico
    S-->>N: OK
    
    N->>S: 2. Busca sponsor por ref_code
    S-->>N: sponsor_id
    
    N->>S: 3. Cria member
    S-->>N: member criado
    
    N->>SH: 4. customerSet mutation
    
    alt Shopify OK
        SH-->>N: customer.id + tags
        N->>S: 5. Atualiza status = ok
    else Shopify FALHA
        SH-->>N: erro
        N->>S: 5. Atualiza status = failed
    end
    
    N->>S: 6. signUp Auth
    S-->>N: JWT session
    
    N-->>U: redirect /dashboard

